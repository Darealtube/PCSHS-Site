import type { GetStaticProps, GetStaticPropsResult } from "next";
import Head from "next/head";
import Announcements from "../Components/Announcements";
import prisma from "../lib/prisma";

type AnnouncementList = {
  header: string;
  body: string;
  footer: string | null;
  image: string | null;
  video: string | null;
  date: string;
  author: {
    image: string | null;
    name: string;
  } | null;
}[];

type Props = {
  announcements: AnnouncementList;
};

const Home = ({ announcements }: Props) => {
  return (
    <>
      <Head>
        <title>PCSHS Home</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Announcements announcements={announcements} />
    </>
  );
};

export default Home;

export const getStaticProps: GetStaticProps = async (): Promise<
  GetStaticPropsResult<Props>
> => {
  const announcements = await prisma.announcement.findMany({
    where: {
      OR: [{ type: "SSG Announcement" }, { type: "School Announcement" }],
    },
    select: {
      header: true,
      body: true,
      footer: true,
      image: true,
      video: true,
      date: true,
      author: {
        select: {
          image: true,
          name: true,
        },
      },
    },
    orderBy: [
      {
        date: "desc",
      },
    ],
  });
  const realAnnouncements = announcements.map((announcement) => ({
    ...announcement,
    date: JSON.stringify(announcement.date),
  }));
  return { props: { announcements: realAnnouncements } };
};
